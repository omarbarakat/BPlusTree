<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<!-- Generated by javadoc on Thu Dec 10 23:29:23 CST 1998 -->
<title>
  Class bufmgr.BufMgr
</title>
</head>
<body>
<a name="_top_"></a>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-bufmgr.html">This Package</a>  <a href="Package-bufmgr.html">Previous</a>  <a href="Package-bufmgr.html">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
  Class bufmgr.BufMgr
</h1>
<pre>
java.lang.Object
   |
   +----bufmgr.BufMgr
</pre>
<hr>
<dl>
  <dt> public class <b>BufMgr</b>
  <dt> extends Object
  <dt> implements <a href="global.GlobalConst.html#_top_">GlobalConst</a>
</dl>
The buffer manager class, it allocates new pages for the
 buffer pool, pins and unpins the frame, frees the frame 
 page, and uses the replacement algorithm to replace the 
 page.
<p>
<hr>
<a name="index"></a>
<h2>
  <img src="images/constructor-index.gif" width=275 height=38 alt="Constructor Index">
</h2>
<dl>
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#BufMgr(int, java.lang.String)"><b>BufMgr</b></a>(int, String)
  <dd> 
 Create a buffer manager object.
</dl>
<h2>
  <img src="images/method-index.gif" width=207 height=38 alt="Method Index">
</h2>
<dl>
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#flushAllPages()"><b>flushAllPages</b></a>()
  <dd> Flushes all pages of the buffer pool to disk 
 
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#flushPage(global.PageId)"><b>flushPage</b></a>(PageId)
  <dd> Added to flush a particular page of the buffer pool to disk
 
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#frameTable()"><b>frameTable</b></a>()
  <dd> A few routines currently need direct access to the FrameTable.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#freePage(global.PageId)"><b>freePage</b></a>(PageId)
  <dd> User should call this method if she needs to delete a page.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#getNumBuffers()"><b>getNumBuffers</b></a>()
  <dd> Gets the total number of buffers.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#getNumUnpinnedBuffers()"><b>getNumUnpinnedBuffers</b></a>()
  <dd> Gets the total number of unpinned buffer frames.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#newPage(diskmgr.Page, int)"><b>newPage</b></a>(Page, int)
  <dd> Call DB object to allocate a run of new pages and 
 find a frame in the buffer pool for the first page
 and pin it.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#pinPage(global.PageId, diskmgr.Page, boolean)"><b>pinPage</b></a>(PageId, Page, boolean)
  <dd> Check if this page is in buffer pool, otherwise
 find a frame for this page, read in and pin it.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#unpinPage(global.PageId, boolean)"><b>unpinPage</b></a>(PageId, boolean)
  <dd> 
 To unpin a page specified by a pageId.
</dl>
<a name="constructors"></a>
<h2>
  <img src="images/constructors.gif" width=231 height=38 alt="Constructors">
</h2>
<a name="BufMgr"></a>
<a name="BufMgr(int, java.lang.String)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>BufMgr</b>
<pre>
 public BufMgr(int numbufs,
               String replacerArg)
</pre>
<dl>
  <dd> Create a buffer manager object.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> numbufs - number of buffers in the buffer pool.
    <dd> replacerArg - name of the buffer replacement policy.
  </dl></dd>
</dl>
<a name="methods"></a>
<h2>
  <img src="images/methods.gif" width=151 height=38 alt="Methods">
</h2>
<a name="pinPage(global.PageId, diskmgr.Page, boolean)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="pinPage"><b>pinPage</b></a>
<pre>
 public void pinPage(<a href="global.PageId.html#_top_">PageId</a> pin_pgid,
                     <a href="diskmgr.Page.html#_top_">Page</a> page,
                     boolean emptyPage) throws <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>, <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>, <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>, <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>, <a href="bufmgr.PageNotReadException.html#_top_">PageNotReadException</a>, <a href="bufmgr.BufferPoolExceededException.html#_top_">BufferPoolExceededException</a>, <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>, <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>, IOException
</pre>
<dl>
  <dd> Check if this page is in buffer pool, otherwise
 find a frame for this page, read in and pin it.
 Also write out the old page if it's dirty before reading
 if emptyPage==TRUE, then actually no read is done to bring
 the page in.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> Page_Id_in_a_DB - page number in the minibase.
    <dd> page - the pointer poit to the page.
    <dd> emptyPage - true (empty page); false (non-empty page)
    <dt> <b>Throws:</b> <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>
    <dd> if there is a replacer error.
    <dt> <b>Throws:</b> <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>
    <dd> if there is a hashtable error.
    <dt> <b>Throws:</b> <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>
    <dd> if there is a page that is already unpinned.
    <dt> <b>Throws:</b> <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>
    <dd> if there is an invalid frame number .
    <dt> <b>Throws:</b> <a href="bufmgr.PageNotReadException.html#_top_">PageNotReadException</a>
    <dd> if a page cannot be read.
    <dt> <b>Throws:</b> <a href="bufmgr.BufferPoolExceededException.html#_top_">BufferPoolExceededException</a>
    <dd> if the buffer pool is full.
    <dt> <b>Throws:</b> <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>
    <dd> if a page is left pinned .
    <dt> <b>Throws:</b> <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>
    <dd> other error occured in bufmgr layer
    <dt> <b>Throws:</b> IOException
    <dd> if there is other kinds of I/O error.
  </dl></dd>
</dl>
<a name="unpinPage(global.PageId, boolean)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="unpinPage"><b>unpinPage</b></a>
<pre>
 public void unpinPage(<a href="global.PageId.html#_top_">PageId</a> PageId_in_a_DB,
                       boolean dirty) throws <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>, <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>, <a href="bufmgr.HashEntryNotFoundException.html#_top_">HashEntryNotFoundException</a>, <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>
</pre>
<dl>
  <dd> To unpin a page specified by a pageId.
If pincount>0, decrement it and if it becomes zero,
 put it in a group of replacement candidates.
 if pincount=0 before this call, return error.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> globalPageId_in_a_DB - page number in the minibase.
    <dd> dirty - the dirty bit of the frame
    <dt> <b>Throws:</b> <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>
    <dd> if there is a replacer error.
    <dt> <b>Throws:</b> <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>
    <dd> if there is a page that is already unpinned.
    <dt> <b>Throws:</b> <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>
    <dd> if there is an invalid frame number .
    <dt> <b>Throws:</b> <a href="bufmgr.HashEntryNotFoundException.html#_top_">HashEntryNotFoundException</a>
    <dd> if there is no entry of page in the hash table.
  </dl></dd>
</dl>
<a name="newPage(diskmgr.Page, int)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="newPage"><b>newPage</b></a>
<pre>
 public <a href="global.PageId.html#_top_">PageId</a> newPage(<a href="diskmgr.Page.html#_top_">Page</a> firstpage,
                       int howmany) throws <a href="bufmgr.BufferPoolExceededException.html#_top_">BufferPoolExceededException</a>, <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>, <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>, <a href="bufmgr.HashEntryNotFoundException.html#_top_">HashEntryNotFoundException</a>, <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>, <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>, <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>, <a href="bufmgr.PageNotReadException.html#_top_">PageNotReadException</a>, <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>, <a href="diskmgr.DiskMgrException.html#_top_">DiskMgrException</a>, IOException
</pre>
<dl>
  <dd> Call DB object to allocate a run of new pages and 
 find a frame in the buffer pool for the first page
 and pin it. If buffer is full, ask DB to deallocate 
 all these pages and return error (null if error).
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> firstpage - the address of the first page.
    <dd> howmany - total number of allocated new pages.
    <dt> <b>Returns:</b>
    <dd> the first page id of the new pages.
    <dt> <b>Throws:</b> <a href="bufmgr.BufferPoolExceededException.html#_top_">BufferPoolExceededException</a>
    <dd> if the buffer pool is full.
    <dt> <b>Throws:</b> <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>
    <dd> if there is a hashtable error.
    <dt> <b>Throws:</b> <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>
    <dd> if there is a replacer error.
    <dt> <b>Throws:</b> <a href="bufmgr.HashEntryNotFoundException.html#_top_">HashEntryNotFoundException</a>
    <dd> if there is no entry of page in the hash table.
    <dt> <b>Throws:</b> <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>
    <dd> if there is an invalid frame number.
    <dt> <b>Throws:</b> <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>
    <dd> if there is a page that is already unpinned.
    <dt> <b>Throws:</b> <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>
    <dd> if a page is left pinned.
    <dt> <b>Throws:</b> <a href="bufmgr.PageNotReadException.html#_top_">PageNotReadException</a>
    <dd> if a page cannot be read.
    <dt> <b>Throws:</b> IOException
    <dd> if there is other kinds of I/O error.
    <dt> <b>Throws:</b> <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>
    <dd> other error occured in bufmgr layer
    <dt> <b>Throws:</b> <a href="diskmgr.DiskMgrException.html#_top_">DiskMgrException</a>
    <dd> other error occured in diskmgr layer
  </dl></dd>
</dl>
<a name="freePage(global.PageId)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="freePage"><b>freePage</b></a>
<pre>
 public void freePage(<a href="global.PageId.html#_top_">PageId</a> globalPageId) throws <a href="bufmgr.InvalidBufferException.html#_top_">InvalidBufferException</a>, <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>, <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>, <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>, <a href="bufmgr.PageNotReadException.html#_top_">PageNotReadException</a>, <a href="bufmgr.BufferPoolExceededException.html#_top_">BufferPoolExceededException</a>, <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>, <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>, <a href="bufmgr.HashEntryNotFoundException.html#_top_">HashEntryNotFoundException</a>, <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>, <a href="diskmgr.DiskMgrException.html#_top_">DiskMgrException</a>, IOException
</pre>
<dl>
  <dd> User should call this method if she needs to delete a page.
 this routine will call DB to deallocate the page.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> globalPageId - the page number in the data base.
    <dt> <b>Throws:</b> <a href="bufmgr.InvalidBufferException.html#_top_">InvalidBufferException</a>
    <dd> if buffer pool corrupted.
    <dt> <b>Throws:</b> <a href="bufmgr.ReplacerException.html#_top_">ReplacerException</a>
    <dd> if there is a replacer error.
    <dt> <b>Throws:</b> <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>
    <dd> if there is a hash table error.
    <dt> <b>Throws:</b> <a href="bufmgr.InvalidFrameNumberException.html#_top_">InvalidFrameNumberException</a>
    <dd> if there is an invalid frame number.
    <dt> <b>Throws:</b> <a href="bufmgr.PageNotReadException.html#_top_">PageNotReadException</a>
    <dd> if a page cannot be read.
    <dt> <b>Throws:</b> <a href="bufmgr.BufferPoolExceededException.html#_top_">BufferPoolExceededException</a>
    <dd> if the buffer pool is already full.
    <dt> <b>Throws:</b> <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>
    <dd> if a page is left pinned.
    <dt> <b>Throws:</b> <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>
    <dd> if there is a page that is already unpinned.
    <dt> <b>Throws:</b> <a href="bufmgr.HashEntryNotFoundException.html#_top_">HashEntryNotFoundException</a>
    <dd> if there is no entry
            of page in the hash table.
    <dt> <b>Throws:</b> IOException
    <dd> if there is other kinds of I/O error.
    <dt> <b>Throws:</b> <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>
    <dd> other error occured in bufmgr layer
    <dt> <b>Throws:</b> <a href="diskmgr.DiskMgrException.html#_top_">DiskMgrException</a>
    <dd> other error occured in diskmgr layer
  </dl></dd>
</dl>
<a name="flushPage(global.PageId)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="flushPage"><b>flushPage</b></a>
<pre>
 public void flushPage(<a href="global.PageId.html#_top_">PageId</a> pageid) throws <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>, <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>, <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>, <a href="bufmgr.PageNotFoundException.html#_top_">PageNotFoundException</a>, <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>, IOException
</pre>
<dl>
  <dd> Added to flush a particular page of the buffer pool to disk
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> pageid - the page number in the database.
    <dt> <b>Throws:</b> <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>
    <dd> if there is a hashtable error.
    <dt> <b>Throws:</b> <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>
    <dd> if there is a page that is already unpinned.
    <dt> <b>Throws:</b> <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>
    <dd> if a page is left pinned.
    <dt> <b>Throws:</b> <a href="bufmgr.PageNotFoundException.html#_top_">PageNotFoundException</a>
    <dd> if a page is not found.
    <dt> <b>Throws:</b> <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>
    <dd> other error occured in bufmgr layer
    <dt> <b>Throws:</b> IOException
    <dd> if there is other kinds of I/O error.
  </dl></dd>
</dl>
<a name="flushAllPages()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="flushAllPages"><b>flushAllPages</b></a>
<pre>
 public void flushAllPages() throws <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>, <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>, <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>, <a href="bufmgr.PageNotFoundException.html#_top_">PageNotFoundException</a>, <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>, IOException
</pre>
<dl>
  <dd> Flushes all pages of the buffer pool to disk
<p>
  <dd><dl>
    <dt> <b>Throws:</b> <a href="bufmgr.HashOperationException.html#_top_">HashOperationException</a>
    <dd> if there is a hashtable error.
    <dt> <b>Throws:</b> <a href="bufmgr.PageUnpinnedException.html#_top_">PageUnpinnedException</a>
    <dd> if there is a page that is already unpinned.
    <dt> <b>Throws:</b> <a href="bufmgr.PagePinnedException.html#_top_">PagePinnedException</a>
    <dd> if a page is left pinned.
    <dt> <b>Throws:</b> <a href="bufmgr.PageNotFoundException.html#_top_">PageNotFoundException</a>
    <dd> if a page is not found.
    <dt> <b>Throws:</b> <a href="bufmgr.BufMgrException.html#_top_">BufMgrException</a>
    <dd> other error occured in bufmgr layer
    <dt> <b>Throws:</b> IOException
    <dd> if there is other kinds of I/O error.
  </dl></dd>
</dl>
<a name="getNumBuffers()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="getNumBuffers"><b>getNumBuffers</b></a>
<pre>
 public int getNumBuffers()
</pre>
<dl>
  <dd> Gets the total number of buffers.
<p>
  <dd><dl>
    <dt> <b>Returns:</b>
    <dd> total number of buffer frames.
  </dl></dd>
</dl>
<a name="getNumUnpinnedBuffers()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="getNumUnpinnedBuffers"><b>getNumUnpinnedBuffers</b></a>
<pre>
 public int getNumUnpinnedBuffers()
</pre>
<dl>
  <dd> Gets the total number of unpinned buffer frames.
<p>
  <dd><dl>
    <dt> <b>Returns:</b>
    <dd> total number of unpinned buffer frames.
  </dl></dd>
</dl>
<a name="frameTable()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="frameTable"><b>frameTable</b></a>
<pre>
 public FrameDesc[] frameTable()
</pre>
<dl>
  <dd> A few routines currently need direct access to the FrameTable.
<p>
</dl>
<hr>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-bufmgr.html">This Package</a>  <a href="Package-bufmgr.html">Previous</a>  <a href="Package-bufmgr.html">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
